---
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import Layout from "../../layouts/Layout.astro";
import NarrativeSection from "../../components/NarrativeSection.astro";
import EventSection from "../../components/EventSection.astro";
import { ArrowUpRight } from "@lucide/astro";
import { useTranslations } from '../../lib/i18n';

const lang = 'en';
const t = useTranslations(lang);

const socials = [
  {
    icon: "youtube.svg",
    url: "https://www.youtube.com/@terrancrypt",
  },
  {
    icon: "x.svg",
    url: "https://x.com/terrancrypt",
  },
  {
    icon: "facebook.svg",
    url: "https://www.facebook.com/terrancrypt",
  },
  {
    icon: "telegram.svg",
    url: "https://t.me/terrancrypt",
  },
  {
    icon: "github.svg",
    url: "https://github.com/terrancrypt",
  },
  {
    icon: "linkedin.svg",
    url: "https://www.linkedin.com/in/terrancrypt/",
  },
];

const positions = [
  {
    name: t('position.devAmbassador.title'),
    description: t('position.devAmbassador.description'),
    image: "Sui_Logo_White.png",
    button: t('position.devAmbassador.button'),
    buttonLink: "https://sui.io.vn",
    bgColor: "#030F1C",
  },
  {
    name: t('position.founder.title'),
    description: t('position.founder.description'),
    image: "Purro_Logo.png",
    button: t('position.founder.button'),
    buttonLink: "https://purro.xyz",
    bgColor: "#166260",
  },
];

const experiences = [
  {
    title: "Developer Ambassador",
    company: "Sui Foundation",
    companyLink: "https://sui.io",
    period: "Jul 2025 - Present",
  },
  {
    title: "Founder",
    company: "Purro",
    companyLink: "https://purro.xyz",
    period: "Jan 2025 - Present",
  },
  {
    title: "Training Specialist",
    company: "VBI Academy",
    companyLink: "https://vbiacademy.edu.vn",
    period: "Feb 2024 - Aug 2025",
  },
  {
    title: "Blockchain Lead",
    company: "OpenEdu",
    companyLink: "https://openedu.net",
    period: "Sep 2024 - Jul 2025",
  },
];
---

<Layout>
  <Header />
  <div class="container mx-auto pt-[100px] md:pt-[120px] text-center px-4">
    <div class="flex items-center justify-center flex-col py-12 md:py-24">
      <img src="/terrannft.png" alt="logo" class="w-24 md:w-30 rounded-full" />
      <p
        class="text-xl md:text-2xl lg:text-3xl font-satoshi-bold mt-4 px-4 max-w-3xl"
        style="background-image: linear-gradient(135deg, #ffffff 0%, #c7d2fe 20%, #ffffff 40%, #a5b4fc 60%, #e0e7ff 80%, #ffffff 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;"
      >
        {t('hero.tagline')}
      </p>
      <p class="text-sm md:text-base text-white/50 mt-2 px-4">
        {t('hero.subtitle')}
      </p>
      <div class="flex flex-wrap items-center justify-center mt-4 z-10 gap-2">
        {
          socials.map((social) => (
            <a
              href={social.url}
              target="_blank"
              class="bg-white/80 border border-white/20 rounded-full p-2 hover:bg-white/90 transition-all duration-300 cursor-pointer"
            >
              <img src={`/${social.icon}`} alt={social.icon} class="w-5 h-5 md:w-6 md:h-6" />
            </a>
          ))
        }
      </div>
    </div>

    <!-- Stacking Cards Container -->
    <div class="py-12 md:py-24 max-w-4xl mx-auto relative">
      {
        positions.map((position, index) => (
          <div
            class="stack-card sticky top-20 mb-2"
            style={`z-index: ${index + 1}; --card-index: ${index};`}
            data-card-index={index}
          >
            <div class="card-content w-full border border-white/10 rounded-2xl md:rounded-4xl py-6 px-5 md:py-[40px] md:px-[30px] flex md:flex-row flex-col-reverse gap-4 md:gap-2 bg-black backdrop-blur-sm">
              <div class="flex flex-col justify-center gap-6 md:gap-16 md:pr-8 md:w-1/2">
                <div class="space-y-2 text-left">
                  <h3 class="text-2xl md:text-3xl">{position.name}</h3>
                  <p class="text-white/80 text-base md:text-lg font-satoshi-light">
                    {position.description}
                  </p>
                </div>

                <a
                  href={position.buttonLink}
                  target="_blank"
                  class="border border-white/20 rounded-full px-4 py-2 w-fit z-10 cursor-pointer hover:bg-white/20 transition-all duration-300 flex items-center gap-2 text-sm md:text-base"
                >
                  {position.button}
                  <ArrowUpRight class="w-4 h-4 md:w-5 md:h-5" />
                </a>
              </div>
              <div
                class="md:w-1/2 aspect-video rounded-xl flex items-center justify-center"
                style={`background-color: ${position.bgColor};`}
              >
                <img
                  src={`/${position.image}`}
                  alt={position.name}
                  class="h-10 md:h-14"
                />
              </div>
            </div>
          </div>
        ))
      }
      <!-- Add spacing at the bottom for scroll continuation -->
      <div class="h-32"></div>
    </div>

    <!-- Narrative Section -->
    <NarrativeSection />

    <!-- Experience Section -->
    <div class="py-12 md:py-24 max-w-4xl mx-auto px-4">
      <h2 class="text-3xl md:text-4xl mb-8 md:mb-12 text-left text-white/80">{t('experience.title')}</h2>
      {
        experiences.map((exp) => (
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center py-4 md:py-6 border-b border-white/10 last:border-b-0">
            <div class="flex-1 mb-3 md:mb-0">
              <h3 class="text-xl md:text-2xl text-white/80 mb-1 md:mb-2 text-left">{exp.title}</h3>
            </div>
            <div class="text-left md:text-right w-fit flex flex-col md:items-end">
              <a
                class="text-white/70 text-base md:text-lg flex items-center hover:text-white/90 transition-all duration-300 w-fit"
                href={exp.companyLink}
                target="_blank"
              >
                {exp.company}
                <ArrowUpRight class="w-4 h-4 md:w-5 md:h-5" />
              </a>
              <p class="text-sm md:text-base text-white/60 font-satoshi-light">{exp.period}</p>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Event Section -->
    <EventSection />

    <!-- Work With Me Section -->
    <div class="py-12 md:py-24 max-w-4xl mx-auto px-4">
      <div
        class="bg-gradient-to-br from-indigo-500/10 via-purple-500/10 to-pink-500/10 border border-white/20 rounded-2xl md:rounded-3xl p-6 md:p-12 text-center"
      >
        <h2 class="text-2xl md:text-3xl lg:text-4xl font-satoshi-bold mb-3 md:mb-4 text-white/90">
          {t('workWithMe.title')}
        </h2>
        <p class="text-base md:text-lg text-white/70 mb-6 md:mb-8 max-w-2xl mx-auto">
          {t('workWithMe.description')}
        </p>

        <div class="flex flex-col items-center gap-3 md:gap-4 mb-6 md:mb-8">
          <a
            href="mailto:thaiphamngoctuong@gmail.com"
            class="inline-flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full px-4 md:px-6 py-3 transition-all duration-300 w-full max-w-sm md:w-auto"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 flex-shrink-0"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect width="20" height="16" x="2" y="4" rx="2"></rect>
              <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
            </svg>
            <span class="font-satoshi-medium text-sm md:text-base truncate">thaiphamngoctuong@gmail.com</span>
          </a>
          
          <a
            href="/en/subscribe"
            class="inline-flex items-center justify-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 rounded-full px-4 md:px-6 py-3 transition-all duration-300 font-satoshi-bold w-full max-w-sm md:w-auto"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 flex-shrink-0"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            <span class="text-sm md:text-base">{t('workWithMe.subscribe')}</span>
          </a>
        </div>

        <div class="flex flex-wrap items-center justify-center gap-2 md:gap-3">
          {
            socials.map((social) => (
              <a
                href={social.url}
                target="_blank"
                class="bg-white hover:bg-white/80 border border-white/20 rounded-full p-2 md:p-3 transition-all duration-300"
              >
                <img
                  src={`/${social.icon}`}
                  alt={social.icon}
                  class="w-4 h-4 md:w-5 md:h-5"
                />
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>
  <Footer />
</Layout>

<style>
  .stack-card {
    transition:
      transform 0.3s ease-out,
      opacity 0.3s ease-out;
  }

  .card-content {
    transition: all 0.3s ease-out;
  }

  /* Stacking effect styles */
  .stack-card.stacked {
    transform: scale(0.95) translateY(-10px);
    opacity: 0.8;
  }

  .stack-card.stacked:nth-child(2) {
    transform: scale(0.9) translateY(-20px);
    opacity: 0.6;
  }

  .stack-card.stacked:nth-child(3) {
    transform: scale(0.85) translateY(-30px);
    opacity: 0.4;
  }
</style>

<script>
  function initStackingCards() {
    const cards = document.querySelectorAll(".stack-card");

    function updateCardStacking() {
      const windowHeight = window.innerHeight;
      const stackingContainer = document.querySelector(
        ".mt-20.max-w-4xl.mx-auto.relative"
      );
      const stackingContainerRect = stackingContainer?.getBoundingClientRect();

      // Check if we should release all cards (when scrolled past the container)
      const shouldReleaseAll =
        stackingContainerRect &&
        stackingContainerRect.bottom <= windowHeight * 0.6;

      cards.forEach((card, index) => {
        const cardElement = card as HTMLElement;

        if (shouldReleaseAll) {
          // Release all cards - hide previous cards and show only content below
          if (index < cards.length - 1) {
            // Hide all cards except the last one
            cardElement.style.opacity = "0";
            cardElement.style.transform = "scale(0.8) translateY(-50px)";
            cardElement.style.pointerEvents = "none";
          } else {
            // Last card - allow it to scroll away naturally
            cardElement.style.position = "relative";
            cardElement.style.transform = "scale(1) translateY(0px)";
            cardElement.style.opacity = "1";
            cardElement.style.pointerEvents = "auto";
          }
          return;
        }

        // Normal stacking logic when not released
        const nextCard = cards[index + 1] as HTMLElement;

        if (nextCard) {
          const nextRect = nextCard.getBoundingClientRect();
          const distanceToNext = nextRect.top - 80;

          // If the next card is approaching, start stacking effect on current card
          if (distanceToNext <= 150 && distanceToNext > 0) {
            const progress = Math.max(
              0,
              Math.min(1, (150 - distanceToNext) / 150)
            );
            const scale = 1 - progress * 0.03;
            const opacity = 1 - progress * 0.2;
            const translateY = -(progress * 15);

            cardElement.style.position = "sticky";
            cardElement.style.transform = `scale(${scale}) translateY(${translateY}px)`;
            cardElement.style.opacity = opacity.toString();
            cardElement.style.pointerEvents = "auto";
          } else {
            // Show peek effect - slightly smaller and offset
            const peekOffset = index * 8; // Each previous card shows 8px below
            cardElement.style.position = "sticky";
            cardElement.style.transform = `scale(0.98) translateY(${peekOffset}px)`;
            cardElement.style.opacity = "0.9";
            cardElement.style.pointerEvents = "auto";
          }
        } else {
          // Last card - full size, no peek effect
          cardElement.style.position = "sticky";
          cardElement.style.transform = "scale(1) translateY(0px)";
          cardElement.style.opacity = "1";
          cardElement.style.pointerEvents = "auto";
        }
      });
    }

    // Throttle scroll events for better performance
    let ticking = false;
    function handleScroll() {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateCardStacking();
          ticking = false;
        });
        ticking = true;
      }
    }

    window.addEventListener("scroll", handleScroll);
    updateCardStacking(); // Initial call
  }

  // Initialize when DOM is loaded
  document.addEventListener("DOMContentLoaded", initStackingCards);
</script>

